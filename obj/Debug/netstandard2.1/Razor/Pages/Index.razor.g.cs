#pragma checksum "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "dd0c1b63f1d456c3de45ee17fa7f03f054dc566a"
// <auto-generated/>
#pragma warning disable 1591
namespace TemporizadoresBlazor.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\_Imports.razor"
using TemporizadoresBlazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\_Imports.razor"
using TemporizadoresBlazor.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\_Imports.razor"
using TemporizadoresBlazor.Helpers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"
using System.Timers;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/")]
    public partial class Index : Microsoft.AspNetCore.Components.ComponentBase, IDisposable
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
            __builder.OpenElement(0, "div");
            __builder.AddAttribute(1, "class", "container");
            __builder.AddMarkupContent(2, "\r\n");
#nullable restore
#line 11 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"
     if (MostrarAviso)
    {

#line default
#line hidden
#nullable disable
            __builder.AddContent(3, "        ");
            __builder.OpenElement(4, "div");
            __builder.AddAttribute(5, "class", "row");
            __builder.AddMarkupContent(6, "\r\n            ");
            __builder.OpenElement(7, "button");
            __builder.AddAttribute(8, "class", "btn btn-info offset-1 col-9");
            __builder.AddAttribute(9, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 14 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"
                                                                    ()=> {
                                                                    MostrarAviso = false;
                                                                    if (DateTime.Now >= TimeReference)
                                                                        TimeReference = default(DateTime);
                                                                    }

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(10, "\r\n                Aviso Temporizador a saltado!\r\n            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(11, "\r\n            <audio id=\"sound\" src=\"Data/beep.mp3\"></audio>\r\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(12, "\r\n");
#nullable restore
#line 23 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"
    }

    else if (MostrarCreador)
    {



#line default
#line hidden
#nullable disable
            __builder.AddContent(13, "        ");
            __builder.OpenComponent<TemporizadoresBlazor.Shared.TemporizadorBuilder>(14);
            __builder.AddAttribute(15, "Created", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<Microsoft.AspNetCore.Components.EventCallback<System.Int32>>(Microsoft.AspNetCore.Components.EventCallback.Factory.Create<System.Int32>(this, 
#nullable restore
#line 29 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"
                                      AddTemporizador

#line default
#line hidden
#nullable disable
            )));
            __builder.AddAttribute(16, "Close", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<Microsoft.AspNetCore.Components.EventCallback>(Microsoft.AspNetCore.Components.EventCallback.Factory.Create(this, 
#nullable restore
#line 29 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"
                                                                () => MostrarCreador = false

#line default
#line hidden
#nullable disable
            )));
            __builder.AddAttribute(17, "ReferenceTime", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.DateTime>(
#nullable restore
#line 29 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"
                                                                                                                TimeReference.IsValid() && DateTime.Now.TotalMinutes()<TimeReference.TotalMinutes()?TimeReference:default(DateTime)

#line default
#line hidden
#nullable disable
            ));
            __builder.CloseComponent();
            __builder.AddMarkupContent(18, "\r\n");
#nullable restore
#line 30 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"


    }
    else
    {

#line default
#line hidden
#nullable disable
            __builder.AddContent(19, "        ");
            __builder.OpenElement(20, "div");
            __builder.AddAttribute(21, "class", "row");
            __builder.AddMarkupContent(22, "\r\n            ");
            __builder.OpenElement(23, "button");
            __builder.AddAttribute(24, "class", "btn btn-success offset-1 col-9");
            __builder.AddAttribute(25, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 36 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"
                                                                       ()=> { MostrarCreador = true;TimeReference = default(DateTime); }

#line default
#line hidden
#nullable disable
            ));
            __builder.CloseElement();
            __builder.AddMarkupContent(26, "\r\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(27, "\r\n        ");
            __builder.OpenElement(28, "div");
            __builder.AddAttribute(29, "class", "tempContainer row");
            __builder.AddMarkupContent(30, "\r\n");
#nullable restore
#line 39 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"
             foreach (var temp in Temporizadores)
            {


#line default
#line hidden
#nullable disable
            __builder.AddContent(31, "                ");
            __builder.OpenComponent<TemporizadoresBlazor.Shared.Temporizador>(32);
            __builder.AddAttribute(33, "HoraFin", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<System.DateTime>(
#nullable restore
#line 42 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"
                                       temp.Value

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(34, "OkeyClick", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<Microsoft.AspNetCore.Components.EventCallback<System.DateTime>>(Microsoft.AspNetCore.Components.EventCallback.Factory.Create<System.DateTime>(this, 
#nullable restore
#line 42 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"
                                                              ()=>RemoveTemporizador(temp.Key)

#line default
#line hidden
#nullable disable
            )));
            __builder.AddAttribute(35, "ContextClick", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<Microsoft.AspNetCore.Components.EventCallback<System.DateTime>>(Microsoft.AspNetCore.Components.EventCallback.Factory.Create<System.DateTime>(this, 
#nullable restore
#line 42 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"
                                                                                                              (referenceTime)=> {
                                                                                                          TimeReference = referenceTime;
                                                                                                          MostrarCreador = true;
                                                                                                        }

#line default
#line hidden
#nullable disable
            )));
            __builder.CloseComponent();
            __builder.AddMarkupContent(36, "\r\n");
#nullable restore
#line 46 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"


            }

#line default
#line hidden
#nullable disable
            __builder.AddContent(37, "        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(38, "\r\n");
#nullable restore
#line 50 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"

    }

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
        }
        #pragma warning restore 1998
#nullable restore
#line 54 "C:\Users\tetra\source\repos\TemporizadoresBlazor\TemporizadoresBlazor\Pages\Index.razor"
      
    const int REFRESHTIME = 1;
    const int TOTALTIMEBEEP = 30;

    SortedList<double, DateTime> Temporizadores { get; set; } = new SortedList<double, DateTime>();
    bool MostrarCreador { get; set; } = false;
    bool MostrarAviso { get; set; } = default;
    Timer Timer { get; set; }
    Timer BeepSound { get; set; }
    int CicloBeep { get; set; } = 0;
    DateTime TimeReference = default(DateTime);

    System.Threading.Semaphore Semaphore { get; set; }

    protected override void OnInitialized()
    {
        Timer = new Timer();
        Timer.Interval = REFRESHTIME * 1000;
        Timer.Elapsed += CheckTimersOut;
        Semaphore = new System.Threading.Semaphore(1, 1);
        BeepSound = new Timer();
        BeepSound.Interval = 500;
        BeepSound.Elapsed += BeepTime;
        Timer.Start();

    }
    void BeepTime(object sender, ElapsedEventArgs e)
    {
        if (MostrarAviso)
        {

            JSRuntime.InvokeVoidAsync("eval",
           "document.getElementById(\'sound\').play();");

            MostrarAviso = ++CicloBeep % TOTALTIMEBEEP != 0;



        }

        if (!MostrarAviso)
        {
            BeepSound.Stop();
            StateHasChanged();
        }

    }

    void CheckTimersOut(object sender, ElapsedEventArgs e)
    {
        double totalMinutes = (TimeSpan.FromHours(DateTime.Now.Hour) + TimeSpan.FromMinutes(DateTime.Now.Minute)).TotalMinutes;

        if (RemoveTemporizador(totalMinutes))
        {
            MostrarAviso = true;
            StateHasChanged();
        }


    }
    bool RemoveTemporizador(double totalMinutes)
    {
        bool removed = false;
        Semaphore.WaitOne();

        if (Temporizadores.ContainsKey(totalMinutes))
        {
            Console.WriteLine($"Timer {totalMinutes} is removed");
            removed = Temporizadores.Remove(totalMinutes);
            BeepSound.Start();

        }
        Semaphore.Release();
        return removed;
    }
    public void Dispose()
    {
        Timer.Dispose();
        Semaphore.Dispose();
        BeepSound.Dispose();
    }
    void AddTemporizador(int totalMinutos)
    {
        TimeSpan time;
        double total;

        if (totalMinutos > 0)
        {

            time = TimeSpan.FromHours(DateTime.Now.Hour) + TimeSpan.FromMinutes(DateTime.Now.Minute);
            total = time.TotalMinutes + totalMinutos;
            Semaphore.WaitOne();
            if (!Temporizadores.ContainsKey(total))
            {
                Temporizadores.Add(total, new DateTime(TimeSpan.FromMinutes(total).Ticks));
                MostrarCreador = false;
                TimeReference = default(DateTime);

            }
            Semaphore.Release();
            if (!MostrarCreador)
                StateHasChanged();
        }
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JSRuntime { get; set; }
    }
}
#pragma warning restore 1591
